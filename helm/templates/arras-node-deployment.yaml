apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "moonray-arras.fullname" . }}-node
  namespace: {{ .Values.namespace }}
spec:
  replicas: {{ .Values.node.replicas }}
  selector:
    matchLabels:
      app: arras-node
      release: {{ .Release.Name }}
  template:
    metadata:
      labels:
        app: arras-node
        release: {{ .Release.Name }}
    spec:
      containers:
      - name: node
        image: {{ .Values.node.image }}
        command:
        - arras4_node
        - --coordinator-host
        - {{ include "moonray-arras.fullname" . }}-coordinator
        - --coordinator-port
        - "{{ .Values.coordinator.port }}"
        - -l
        - "{{ .Values.node.logLevel }}"
        - --no-consul
        env:
        - name: PATH
          value: "/installs/moonray-renderer/bin:$PATH"
        - name: RDL2_DSO_PATH
          value: "/installs/moonray-renderer/rdl2dso:/installs/moonray-renderer/rdl2dso.proxy"
        resources:
{{ toYaml .Values.node.resources | indent 10 }}